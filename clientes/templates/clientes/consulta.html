{% extends 'layout.html' %}
{% load i18n %}

{% block title %}{% trans "Consulta de Clientes" %}{% endblock %}

{% block content %}
<h2 class="mb-4">{% trans "Consulta de Clientes y Direcciones" %}</h2>

<div class="mb-3">
  <a href="{% url 'exportar_clientes_excel' %}" class="btn btn-success me-2">
    <i class="fas fa-file-excel"></i> {% trans "Exportar a Excel" %}
  </a>
  <a href="{% url 'exportar_clientes_pdf' %}" class="btn btn-danger">
    <i class="fas fa-file-pdf"></i> {% trans "Exportar a PDF" %}
  </a>
</div>

<table class="table table-bordered table-striped" id="tabla-clientes">
  <thead>
    <tr>
      <th>{% trans "Cliente" %}</th>
      <th>{% trans "Correo Electrónico" %}</th>
      <th>{% trans "Comuna" %}</th>
      <th>{% trans "Ciudad" %}</th>
      <th>{% trans "Dirección" %}</th>
      <th>{% trans "País" %}</th>
    </tr>
  </thead>
  <tbody>
    {% for cliente in clientes %}
      {% for direccion in cliente.direcciones.all %}
        <tr>
          <td>{{ cliente.nombre_razon_social }}</td>
          <td>{{ cliente.email }}</td>
          <td>{{ direccion.comuna }}</td>
          <td>{{ direccion.ciudad }}</td>
          <td>{{ direccion.calle }} {{ direccion.numero }}</td>
          <td>{{ direccion.pais }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="5" class="text-muted">{% trans "Sin direcciones registradas" %}</td>
        </tr>
      {% endfor %}
    {% endfor %}
  </tbody>
</table>

<div class="mt-4 d-flex justify-content-start">
  <a href="{% url 'lista_clientes' %}" class="btn btn-danger ms-2">{% trans "Cancelar" %}</a>
</div>


<script>
function exportToExcel() {
  const table = document.getElementById('tabla-clientes');
  const html = table.outerHTML.replace(/ /g, '%20');
  const filename = 'clientes_direcciones.xls';
  const uri = 'data:application/vnd.ms-excel,' + html;

  const link = document.createElement('a');
  link.href = uri;
  link.download = filename;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
</script>
{% endblock %}